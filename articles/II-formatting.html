<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="timaR">
<title>2 Formatting all inputs â€¢ timaR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2 Formatting all inputs">
<meta property="og:description" content="timaR">
<meta property="og:image" content="https://github.com/taxonomicallyinformedannotation/tima-r/blob/main/man/figures/logo.svg">
<meta property="og:image:alt" content="Taxonomically Informed Metabolite Annotation">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@adafede">
<meta name="twitter:site" content="@adafede">
<meta name="google-site-verification" content="Bt77rpBuC_R-0p62TWtA_ba5rvx-PuSEMv4LHg1UsOo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">timaR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/timaR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/I-inputs.html">1 Inputs: Getting everything you need</a>
    <a class="dropdown-item" href="../articles/II-formatting.html">2 Formatting all inputs</a>
    <a class="dropdown-item" href="../articles/III-processing.html">3 Performing Taxonomically Informed Metabolite Annotation</a>
    <a class="dropdown-item" href="../articles/IV-actual-performance.html">4 Actual Performance</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/taxonomicallyinformedannotation/tima-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="II-formatting_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="II-formatting_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="II-formatting_files/vis-9.1.0/vis-network.min.js"></script><script src="II-formatting_files/visNetwork-binding-2.1.2/visNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>2 Formatting all inputs</h1>
                        <h4 data-toc-skip class="author">Adriano
Rutz</h4>
            
            <h4 data-toc-skip class="date">2023-10-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/taxonomicallyinformedannotation/tima-r/blob/HEAD/vignettes/II-formatting.Rmd" class="external-link"><code>vignettes/II-formatting.Rmd</code></a></small>
      <div class="d-none name"><code>II-formatting.Rmd</code></div>
    </div>

    
    
<p>This vignette describes how to format all your files.</p>
<div class="section level2">
<h2 id="structural-annotations-of-your-features">Structural annotations of your features<a class="anchor" aria-label="anchor" href="#structural-annotations-of-your-features"></a>
</h2>
<p>For the moment, we support annotations coming from 4 different
annotation tools:</p>
<ul>
<li>MS<sup>1</sup> exact mass-based library search</li>
<li><a href="https://gnps.ucsd.edu" class="external-link">GNPS</a></li>
<li><a href="https://bio.informatik.uni-jena.de/software/sirius" class="external-link">SIRIUS</a></li>
<li>Formatted results of <strong>ISDB</strong> annotation.</li>
</ul>
<div class="section level3">
<h3 id="ms1-based">MS<sup>1</sup>-based<a class="anchor" aria-label="anchor" href="#ms1-based"></a>
</h3>
<p>These annotations are of the lowest possible quality. However, they
allow to annotate unusual adducts, in-source fragments thanks to
different small tricks implemented. Try to really restrict the adduct
list and structure-organism pairs you want to consider as possibilities
explode rapidly.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/taxonomicallyinformedannotation/tima-r" class="external-link">"timaR"</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/annotate_masses.R"</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0b75441d1fbaf012fcc8" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-0b75441d1fbaf012fcc8">{"x":{"nodes":{"name":["ann_ms1_pre","ann_ms1_pre_ann","ann_ms1_pre_edg","dic_add","dic_clu","dic_neu_los","fea_pre","gnps_features","gnps_tables","input_features","lib_add","lib_mer_key","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer"],"type":["stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem"],"status":["outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","outdated","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated"],"seconds":[36.264,0,0,0.002,0.048,0.044,0.891,0.001,0.108,0.001,8.637,0,0.001,0,0,0,0.001,1.084,0.001,0.854,0.429,0.971,2.943,31.28,77.408],"bytes":[18312966,17966520,346446,240,349,1962,126373,775595,6223518,775595,35334485,15498233,9005791,11039690,8707163,2492003,2389496,174,86,268,239,336,92979778,46526322,50071379],"branches":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"label":["ann_ms1_pre","ann_ms1_pre_ann","ann_ms1_pre_edg","dic_add","dic_clu","dic_neu_los","fea_pre","gnps_features","gnps_tables","input_features","lib_add","lib_mer_key","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer"],"color":["#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5"],"id":["ann_ms1_pre","ann_ms1_pre_ann","ann_ms1_pre_edg","dic_add","dic_clu","dic_neu_los","fea_pre","gnps_features","gnps_tables","input_features","lib_add","lib_mer_key","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer"],"level":[6,7,7,1,1,1,4,2,1,3,5,4,4,4,4,4,4,1,2,1,1,2,1,2,3],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"]},"edges":{"from":["ann_ms1_pre","lib_sop_mer","ann_ms1_pre","lib_rt","gnps_features","lib_sop_mer","lib_sop_mer","lib_sop_ecm","dic_add","dic_clu","lib_mer_str_met","lib_sop_lot","dic_add","dic_clu","dic_neu_los","fea_pre","lib_add","lib_mer_key","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_sop_mer","lib_sop_mer","gnps_tables","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm_pre","lib_sop_lot_pre","lib_sop_mer","input_features"],"to":["ann_ms1_pre_ann","lib_mer_key","ann_ms1_pre_edg","lib_rt_sop","input_features","lib_mer_str_stereo","lib_mer_str_nam","lib_sop_ecm_pre","lib_add","lib_add","lib_add","lib_sop_lot_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","lib_mer_str_met","lib_mer_str_tax_npc","gnps_features","lib_sop_mer","lib_sop_mer","lib_sop_mer","lib_sop_mer","lib_mer_str_tax_cla","fea_pre"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":8,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Up to date","Stem"],"color":["#78B7C5","#354823","#899DA4"],"shape":["dot","dot","dot"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="spectral">Spectral<a class="anchor" aria-label="anchor" href="#spectral"></a>
</h3>
<p>In order to perform MS<sup>2</sup> annotation based on an
<strong>I</strong>n <strong>S</strong>ilico
<strong>D</strong>ata<strong>B</strong>ase, please follow the following
steps.</p>
<div class="section level4">
<h4 id="isdb">ISDB<a class="anchor" aria-label="anchor" href="#isdb"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/annotate_spectra.R"</span><span class="op">)</span></span></code></pre></div>
<p>We use the <code>spectral entropy</code> from <a href="https://doi.org/10.1038/s41592-021-01331-z" class="external-link uri">https://doi.org/10.1038/s41592-021-01331-z</a> for
matching.</p>
<p>In case, a python implementation of the spectral matching steps is
also available at: <a href="https://github.com/mandelbrot-project/spectral_lib_matcher" class="external-link uri">https://github.com/mandelbrot-project/spectral_lib_matcher</a>.
The python version also includes other similarity measures.</p>
<p>And as before:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_annotations_spectra.R"</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8c881506faf48ea05177" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-8c881506faf48ea05177">{"x":{"nodes":{"name":[],"type":[],"status":[],"seconds":[],"bytes":[],"branches":[],"label":[],"color":[],"id":[],"shape":[]},"edges":{"from":[],"to":[],"arrows":[]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":0,"to":0},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":[],"color":[],"shape":[]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="gnps">GNPS<a class="anchor" aria-label="anchor" href="#gnps"></a>
</h4>
<p>We also provide an example GNPS job id, which is:
<code>41c6068e905d482db5698ad81d145d7c</code></p>
<p>Before running the corresponding code, do not forget to modify
<code>inst/params/user/prepare_*yourAnnotationTool*.yaml</code>.</p>
<p>Depending on the annotation tool you used, you can format its results
using:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_annotations_gnps.R"</span><span class="op">)</span></span></code></pre></div>
<p>You now have all your spectral annotations:</p>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-dfdcd5aa1d1f38e620ee" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-dfdcd5aa1d1f38e620ee">{"x":{"nodes":{"name":["ann_spe_exp_gnp_pre","gnps_annotations","gnps_tables","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","lib_spe_exp_mb_pre_pos","ann_spe_neg","ann_spe_pos","ann_spe_pre","lib_spe_exp_int_pre","gnps_spectra","lib_spe_exp_int_pre_pos","input_spectra","lib_spe_exp_mb_pre_neg","lib_spe_exp_int_pre_neg","lib_spe_exp_mb_pre"],"type":["stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem"],"status":["outdated","uptodate","uptodate","outdated","outdated","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","uptodate","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"seconds":[15.619,0,0.108,0.001,0,0,0,0.001,1.084,0.001,0.854,0.429,0.971,3.068,31.28,77.408,1.777,0.008,0.001,0,0.001,null,null,null,null,null,null,null,null,null,null,null],"bytes":[48401,405915,6223518,9005791,11039690,8707163,2492003,2389496,174,86,268,239,336,92979778,46526322,50071379,99790446,168713071,221799775,168713071,221799775,null,null,null,null,null,null,null,null,null,null,null],"branches":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"label":["ann_spe_exp_gnp_pre","gnps_annotations","gnps_tables","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","lib_spe_exp_mb_pre_pos","ann_spe_neg","ann_spe_pos","ann_spe_pre","lib_spe_exp_int_pre","gnps_spectra","lib_spe_exp_int_pre_pos","input_spectra","lib_spe_exp_mb_pre_neg","lib_spe_exp_int_pre_neg","lib_spe_exp_mb_pre"],"color":["#78B7C5","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["ann_spe_exp_gnp_pre","gnps_annotations","gnps_tables","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","lib_spe_exp_mb_pre_pos","ann_spe_neg","ann_spe_pos","ann_spe_pre","lib_spe_exp_int_pre","gnps_spectra","lib_spe_exp_int_pre_pos","input_spectra","lib_spe_exp_mb_pre_neg","lib_spe_exp_int_pre_neg","lib_spe_exp_mb_pre"],"level":[5,2,1,4,4,4,4,4,1,2,1,1,2,1,2,3,1,1,1,2,2,3,4,4,5,1,2,2,3,3,2,2],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"]},"edges":{"from":["lib_rt","gnps_tables","lib_spe_is_lot_neg","lib_sop_mer","lib_spe_is_lot_pos","lib_sop_mer","lib_spe_exp_int_pre","input_spectra","lib_spe_exp_int_pre_neg","lib_spe_exp_mb_pre_neg","lib_spe_is_lot_pre_neg","gnps_annotations","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_spe_exp_mb_pre","lib_spe_exp_int_pre","lib_sop_ecm","gnps_tables","lib_spe_exp_mb_pre","gnps_spectra","lib_sop_lot","ann_spe_neg","ann_spe_pos","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_sop_mer","lib_sop_mer","lib_spe_exp_mb_raw","input_spectra","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre_pos","lib_spe_is_lot_pre_pos","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm_pre","lib_sop_lot_pre","lib_sop_mer"],"to":["lib_rt_sop","gnps_spectra","lib_spe_is_lot_pre_neg","lib_mer_str_stereo","lib_spe_is_lot_pre_pos","lib_mer_str_nam","lib_spe_exp_int_pre_pos","ann_spe_neg","ann_spe_neg","ann_spe_neg","ann_spe_neg","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","lib_spe_exp_mb_pre_neg","lib_spe_exp_int_pre_neg","lib_sop_ecm_pre","gnps_annotations","lib_spe_exp_mb_pre_pos","input_spectra","lib_sop_lot_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","lib_mer_str_met","lib_mer_str_tax_npc","lib_spe_exp_mb_pre","ann_spe_pos","ann_spe_pos","ann_spe_pos","ann_spe_pos","lib_sop_mer","lib_sop_mer","lib_sop_mer","lib_sop_mer","lib_mer_str_tax_cla"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":8,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Up to date","Stem"],"color":["#78B7C5","#354823","#899DA4"],"shape":["dot","dot","dot"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level3">
<h3 id="fingerprint-based">Fingerprint-based<a class="anchor" aria-label="anchor" href="#fingerprint-based"></a>
</h3>
<div class="section level4">
<h4 id="sirius">Sirius<a class="anchor" aria-label="anchor" href="#sirius"></a>
</h4>
<p>As SIRIUS jobs are long to perform, we provide an already computed
SIRIUS Workspace. It has been generated on the same MGF as the GNPS and
ISDB jobs with the following command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">config</span> <span class="at">--IsotopeSettings.filter</span> true <span class="at">--FormulaSearchDB</span> BIO,COCONUT,GNPS,KNAPSACK,UNDP,PLANTCYC <span class="at">--Timeout.secondsPerTree</span> 0 <span class="at">--FormulaSettings.enforced</span> HCNOP <span class="at">--Timeout.secondsPerInstance</span> 0 <span class="at">--AdductSettings.detectable</span> [[M + H3N + H]+, [M <span class="at">-</span> H2O + H]+, [M + K]+, [M <span class="at">-</span> H4O2 + H]+, [M + H]+, [M + Na]+] <span class="at">--UseHeuristic.mzToUseHeuristicOnly</span> 650 <span class="at">--AlgorithmProfile</span> orbitrap <span class="at">--IsotopeMs2Settings</span> IGNORE <span class="at">--MS2MassDeviation.allowedMassDeviation</span> 5.0ppm <span class="at">--NumberOfCandidatesPerIon</span> 1 <span class="at">--UseHeuristic.mzToUseHeuristic</span> 300 <span class="at">--FormulaSettings.detectable</span> B,Cl,Br,Se,S <span class="at">--NumberOfCandidates</span> 10 <span class="at">--ZodiacNumberOfConsideredCandidatesAt300Mz</span> 10 <span class="at">--ZodiacRunInTwoSteps</span> true <span class="at">--ZodiacEdgeFilterThresholds.minLocalConnections</span> 10 <span class="at">--ZodiacEdgeFilterThresholds.thresholdFilter</span> 0.95 <span class="at">--ZodiacEpochs.burnInPeriod</span> 2000 <span class="at">--ZodiacEpochs.numberOfMarkovChains</span> 10 <span class="at">--ZodiacNumberOfConsideredCandidatesAt800Mz</span> 50 <span class="at">--ZodiacEpochs.iterations</span> 20000 <span class="at">--AdductSettings.enforced</span> , <span class="at">--AdductSettings.fallback</span> [[M + K]+, [M + H]+, [M + Na]+] <span class="at">--FormulaResultThreshold</span> true <span class="at">--InjectElGordoCompounds</span> true <span class="at">--StructureSearchDB</span> BIO,COCONUT,GNPS,KNAPSACK,UNDP,PLANTCYC <span class="at">--RecomputeResults</span> false formula zodiac fingerprint structure canopus</span></code></pre></div>
<p>These parameters were not optimized and were only used to give an
example output.</p>
<p>Then, the summaries have been generated using:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sirius</span> <span class="at">-i</span> inst/extdata/interim/annotations/sirius_example/ write-summaries <span class="at">-c</span> <span class="at">--digits</span> 3</span></code></pre></div>
<p>You can get the example running:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/get_example_sirius.R"</span><span class="op">)</span></span></code></pre></div>
<p>Then prepare it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_annotations_sirius.R"</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d87a460fded5baa1f659" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-d87a460fded5baa1f659">{"x":{"nodes":{"name":["ann_sir_pre","ann_sir_pre_can","ann_sir_pre_for","ann_sir_pre_str","ann_spe_exp_gnp_pre","gnps_annotations","gnps_tables","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","lib_spe_exp_int_pre_neg","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre","lib_spe_exp_mb_pre_neg","lib_spe_exp_mb_pre_pos","ann_spe_neg","ann_spe_pos","ann_spe_pre","gnps_spectra","input_spectra","lib_spe_exp_int_pre"],"type":["stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem"],"status":["outdated","outdated","outdated","outdated","outdated","uptodate","uptodate","outdated","outdated","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","uptodate","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"seconds":[15.666,0.001,0.001,0.001,15.619,0,0.108,0.001,0,0,0,0.001,1.084,0.001,0.854,0.429,0.971,3.266,31.28,77.408,1.777,0.008,0.001,0,0.001,null,null,null,null,null,null,null,null,null,null,null],"bytes":[42620,1059,493,41068,48401,405915,6223518,9005791,11039690,8707163,2492003,2389496,174,86,268,239,336,92979778,46526322,50071379,99790446,168713071,221799775,168713071,221799775,null,null,null,null,null,null,null,null,null,null,null],"branches":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"label":["ann_sir_pre","ann_sir_pre_can","ann_sir_pre_for","ann_sir_pre_str","ann_spe_exp_gnp_pre","gnps_annotations","gnps_tables","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","lib_spe_exp_int_pre_neg","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre","lib_spe_exp_mb_pre_neg","lib_spe_exp_mb_pre_pos","ann_spe_neg","ann_spe_pos","ann_spe_pre","gnps_spectra","input_spectra","lib_spe_exp_int_pre"],"color":["#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["ann_sir_pre","ann_sir_pre_can","ann_sir_pre_for","ann_sir_pre_str","ann_spe_exp_gnp_pre","gnps_annotations","gnps_tables","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","lib_spe_exp_int_pre_neg","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre","lib_spe_exp_mb_pre_neg","lib_spe_exp_mb_pre_pos","ann_spe_neg","ann_spe_pos","ann_spe_pre","gnps_spectra","input_spectra","lib_spe_exp_int_pre"],"level":[5,6,6,6,5,2,1,4,4,4,4,4,1,2,1,1,2,1,2,3,1,1,1,2,2,2,2,2,3,3,4,4,5,2,3,1],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"]},"edges":{"from":["lib_rt","gnps_tables","lib_spe_is_lot_neg","lib_sop_mer","lib_spe_is_lot_pos","lib_sop_mer","ann_sir_pre","lib_spe_exp_int_pre","ann_sir_pre","input_spectra","lib_spe_exp_int_pre_neg","lib_spe_exp_mb_pre_neg","lib_spe_is_lot_pre_neg","ann_sir_pre","gnps_annotations","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_spe_exp_mb_pre","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_spe_exp_int_pre","lib_sop_ecm","gnps_tables","lib_spe_exp_mb_pre","gnps_spectra","lib_sop_lot","ann_spe_neg","ann_spe_pos","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_sop_mer","lib_sop_mer","lib_spe_exp_mb_raw","input_spectra","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre_pos","lib_spe_is_lot_pre_pos","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm_pre","lib_sop_lot_pre","lib_sop_mer"],"to":["lib_rt_sop","gnps_spectra","lib_spe_is_lot_pre_neg","lib_mer_str_stereo","lib_spe_is_lot_pre_pos","lib_mer_str_nam","ann_sir_pre_can","lib_spe_exp_int_pre_pos","ann_sir_pre_for","ann_spe_neg","ann_spe_neg","ann_spe_neg","ann_spe_neg","ann_sir_pre_str","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","lib_spe_exp_mb_pre_neg","ann_sir_pre","ann_sir_pre","ann_sir_pre","ann_sir_pre","ann_sir_pre","lib_spe_exp_int_pre_neg","lib_sop_ecm_pre","gnps_annotations","lib_spe_exp_mb_pre_pos","input_spectra","lib_sop_lot_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","lib_mer_str_met","lib_mer_str_tax_npc","lib_spe_exp_mb_pre","ann_spe_pos","ann_spe_pos","ann_spe_pos","ann_spe_pos","lib_sop_mer","lib_sop_mer","lib_sop_mer","lib_sop_mer","lib_mer_str_tax_cla"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":8,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Up to date","Stem"],"color":["#78B7C5","#354823","#899DA4"],"shape":["dot","dot","dot"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>You now have your annotations well prepared and can keep on
formatting the rest of your metadata. Your features are not only
informed with structural information but also, chemical class
information. The latter might be corresponding <strong>or not</strong>
to the chemical class of your annotated structure, depending on the
consistency of your annotations.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="chemical-class-annotation-of-your-features">Chemical class annotation of your features<a class="anchor" aria-label="anchor" href="#chemical-class-annotation-of-your-features"></a>
</h2>
<p>Within our workflow, we offer a new way to attribute chemical classes
to your features. It is analog to <a href="https://ccms-ucsd.github.io/GNPSDocumentation/nap/" class="external-link">Network
Annotation Propagation</a>, but uses the edges of your network instead
of the clusters. This makes more sense in our view, as also recently
illustrated by <a href="https://doi.org/10.1038/s41587-020-0740-8" class="external-link">CANOPUS</a>.</p>
<p>All steps can take both manual inputs or GNPS metadata directly from
your GNPS job ID.</p>
<p>We are currently also working on CANOPUS integration for chemical
class annotation but this implies way heavier computations and we want
to offer our users a <strong>fast</strong> solution.</p>
<div class="section level3">
<h3 id="case-when-no-network-available">Case when no network available<a class="anchor" aria-label="anchor" href="#case-when-no-network-available"></a>
</h3>
<p>If no network was generated previously on GNPS (no GNPS job ID
provided), it can be generated using:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/create_edges_spectra.R"</span><span class="op">)</span></span></code></pre></div>
<p>Again, the edges are created based on the
<code>spectral entropy similarity</code> calculated between your spectra
(see <a href="https://doi.org/10.1038/s41592-021-01331-z" class="external-link uri">https://doi.org/10.1038/s41592-021-01331-z</a>).</p>
<p>If needed, you can get an example of what your minimal feature table
should look like by running (no parameters needed):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/get_example_features.R"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="formatting">Formatting<a class="anchor" aria-label="anchor" href="#formatting"></a>
</h3>
<p>Before running the corresponding code, do not forget to modify
<code>inst/params/user/prepare_features_tables.yaml</code>,
<code>inst/params/user/prepare_features_edges.yaml</code>,
<code>inst/params/user/create_components.yaml</code>, and
<code>inst/params/user/prepare_features_components.yaml</code>
accordingly.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_features_tables.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_features_edges.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/create_components.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_features_components.R"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="biological-source-annotation">Biological source annotation<a class="anchor" aria-label="anchor" href="#biological-source-annotation"></a>
</h2>
<p>This step allows you to attribute biological source information to
your features. If all your features come from a single extract, it will
attribute the biological source of your extract to all your features. If
you have multiple extracts aligned, it will take the <em>n</em>
(according to your parameters) highest intensities of your aligned
feature table and attribute the biological source of corresponding
extracts. It can take both manual inputs or GNPS metadata directly from
your GNPS job ID.</p>
<p>Before running the corresponding code, do not forget to modify
<code>inst/params/user/prepare_taxa.yaml</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_taxa.R"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filter-annotations-based-on-retention-time">Filter annotations (based on retention time)<a class="anchor" aria-label="anchor" href="#filter-annotations-based-on-retention-time"></a>
</h2>
<p>This step allows you to filter out the annotation of all the tools
used, based on your own internal (experimental or predicted) retention
times library. It is optional. If you do not have one, it will simply
group the annotations of all tools.</p>
<p>Before running the corresponding code, do not forget to modify
<code>inst/params/user/filter_annotations.yaml</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/filter_annotations.R"</span><span class="op">)</span></span></code></pre></div>
<p>You are almost there! See already all the steps accomplished!</p>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-47ca6cf13faabc1a6db3" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-47ca6cf13faabc1a6db3">{"x":{"nodes":{"name":["ann_fil","ann_ms1_pre","ann_ms1_pre_ann","ann_ms1_pre_edg","ann_sir_pre","ann_sir_pre_can","ann_sir_pre_for","ann_sir_pre_str","ann_spe_exp_gnp_pre","ann_spe_neg","ann_spe_pos","ann_spe_pre","dic_add","dic_clu","dic_neu_los","edg_spe","fea_com","fea_com_pre","fea_edg_pre","fea_edg_spe","fea_pre","gnps_annotations","gnps_components","gnps_edges","gnps_features","gnps_metadata","gnps_spectra","gnps_tables","input_features","input_metadata","input_spectra","int_com","lib_add","lib_mer_key","lib_mer_org_tax_ott","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_rts","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_int_pre","lib_spe_exp_int_pre_neg","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre","lib_spe_exp_mb_pre_neg","lib_spe_exp_mb_pre_pos","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","tax_pre","ann_pre"],"type":["stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem","stem"],"status":["outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","outdated","outdated","outdated","outdated","outdated","outdated"],"seconds":[6.434,36.264,0,0,15.666,0.001,0.001,0.001,15.619,0.43,232.852,11.658,0.002,0.048,0.044,0,1.118,0.062,0.951,4.895,0.891,0.001,0.001,0,0,0.001,0,0.095,0.001,0,0.001,0,8.637,0,0,0.001,0,0,0,0.001,1.084,0,0.001,0.854,0.429,0.971,3.056,31.28,77.408,1.838,0.001,0.006,426.194,0,0.001,1.777,0.006,0.001,0,0.001,4.845,null],"bytes":[18550994,18312966,17966520,346446,42620,1059,493,41068,48401,177,48712,74651,240,349,1962,686,46354,46349,365350,686,126373,405915,46354,686,775595,260,16465,1245275,775595,260,16465,46354,35334485,15498233,939003,9005791,11039690,8707163,2492003,2389496,174,88,86,268,239,336,92979778,46526322,50071379,179172,49002,130170,22584819,5787003,16797816,99790446,168713071,221799775,168713071,221799775,27875,null],"branches":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"label":["ann_fil","ann_ms1_pre","ann_ms1_pre_ann","ann_ms1_pre_edg","ann_sir_pre","ann_sir_pre_can","ann_sir_pre_for","ann_sir_pre_str","ann_spe_exp_gnp_pre","ann_spe_neg","ann_spe_pos","ann_spe_pre","dic_add","dic_clu","dic_neu_los","edg_spe","fea_com","fea_com_pre","fea_edg_pre","fea_edg_spe","fea_pre","gnps_annotations","gnps_components","gnps_edges","gnps_features","gnps_metadata","gnps_spectra","gnps_tables","input_features","input_metadata","input_spectra","int_com","lib_add","lib_mer_key","lib_mer_org_tax_ott","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_rts","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_int_pre","lib_spe_exp_int_pre_neg","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre","lib_spe_exp_mb_pre_neg","lib_spe_exp_mb_pre_pos","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","tax_pre","ann_pre"],"color":["#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823","#354823","#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["ann_fil","ann_ms1_pre","ann_ms1_pre_ann","ann_ms1_pre_edg","ann_sir_pre","ann_sir_pre_can","ann_sir_pre_for","ann_sir_pre_str","ann_spe_exp_gnp_pre","ann_spe_neg","ann_spe_pos","ann_spe_pre","dic_add","dic_clu","dic_neu_los","edg_spe","fea_com","fea_com_pre","fea_edg_pre","fea_edg_spe","fea_pre","gnps_annotations","gnps_components","gnps_edges","gnps_features","gnps_metadata","gnps_spectra","gnps_tables","input_features","input_metadata","input_spectra","int_com","lib_add","lib_mer_key","lib_mer_org_tax_ott","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_rt","lib_rt_rts","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm","lib_sop_ecm_pre","lib_sop_lot","lib_sop_lot_pre","lib_sop_mer","lib_spe_exp_int_pre","lib_spe_exp_int_pre_neg","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre","lib_spe_exp_mb_pre_neg","lib_spe_exp_mb_pre_pos","lib_spe_exp_mb_raw","lib_spe_is_lot_neg","lib_spe_is_lot_pos","lib_spe_is_lot_pre_neg","lib_spe_is_lot_pre_pos","tax_pre","ann_pre"],"level":[8,6,7,7,5,6,6,6,5,4,4,5,1,1,1,5,9,11,8,4,4,2,2,2,2,2,2,1,3,3,3,10,5,4,4,4,4,4,4,4,1,2,2,1,1,2,1,2,3,1,2,2,2,3,3,1,1,1,2,2,5,12],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"]},"edges":{"from":["gnps_tables","lib_sop_mer","int_com","ann_ms1_pre","lib_sop_mer","ann_ms1_pre","lib_rt","gnps_tables","gnps_features","lib_spe_is_lot_neg","fea_edg_pre","lib_sop_mer","lib_spe_is_lot_pos","lib_sop_mer","ann_sir_pre","gnps_tables","ann_fil","ann_sir_pre_can","ann_sir_pre_for","fea_com_pre","fea_edg_pre","lib_mer_key","lib_mer_org_tax_ott","lib_mer_str_stereo","tax_pre","fea_com","gnps_components","lib_spe_exp_int_pre","ann_sir_pre","input_features","input_metadata","lib_mer_org_tax_ott","input_spectra","lib_spe_exp_int_pre_neg","lib_spe_exp_mb_pre_neg","lib_spe_is_lot_pre_neg","input_spectra","ann_sir_pre","gnps_annotations","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_spe_exp_mb_pre","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","gnps_metadata","lib_spe_exp_int_pre","lib_sop_ecm","lib_rt","gnps_tables","dic_add","dic_clu","lib_mer_str_met","lib_spe_exp_mb_pre","gnps_spectra","gnps_tables","lib_sop_lot","ann_spe_neg","ann_spe_pos","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","dic_add","dic_clu","dic_neu_los","fea_pre","lib_add","lib_mer_key","lib_mer_str_met","lib_mer_str_nam","lib_mer_str_stereo","lib_mer_str_tax_cla","lib_mer_str_tax_npc","lib_sop_mer","lib_sop_mer","gnps_tables","lib_spe_exp_mb_raw","input_spectra","lib_spe_exp_int_pre_pos","lib_spe_exp_mb_pre_pos","lib_spe_is_lot_pre_pos","lib_rt_sop","lib_sop_clo_pre","lib_sop_ecm_pre","lib_sop_lot_pre","ann_ms1_pre_edg","edg_spe","ann_ms1_pre_ann","ann_sir_pre_str","ann_spe_exp_gnp_pre","ann_spe_pre","fea_pre","lib_rt_rts","fea_edg_spe","gnps_edges","lib_sop_mer","input_features"],"to":["gnps_edges","lib_mer_org_tax_ott","fea_com_pre","ann_ms1_pre_ann","lib_mer_key","ann_ms1_pre_edg","lib_rt_sop","gnps_spectra","input_features","lib_spe_is_lot_pre_neg","fea_com","lib_mer_str_stereo","lib_spe_is_lot_pre_pos","lib_mer_str_nam","ann_sir_pre_can","gnps_metadata","ann_pre","ann_pre","ann_pre","ann_pre","ann_pre","ann_pre","ann_pre","ann_pre","ann_pre","int_com","int_com","lib_spe_exp_int_pre_pos","ann_sir_pre_for","tax_pre","tax_pre","tax_pre","ann_spe_neg","ann_spe_neg","ann_spe_neg","ann_spe_neg","fea_edg_spe","ann_sir_pre_str","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","ann_spe_exp_gnp_pre","lib_spe_exp_mb_pre_neg","ann_sir_pre","ann_sir_pre","ann_sir_pre","ann_sir_pre","ann_sir_pre","input_metadata","lib_spe_exp_int_pre_neg","lib_sop_ecm_pre","lib_rt_rts","gnps_annotations","lib_add","lib_add","lib_add","lib_spe_exp_mb_pre_pos","input_spectra","gnps_components","lib_sop_lot_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_spe_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","ann_ms1_pre","lib_mer_str_met","lib_mer_str_tax_npc","gnps_features","lib_spe_exp_mb_pre","ann_spe_pos","ann_spe_pos","ann_spe_pos","ann_spe_pos","lib_sop_mer","lib_sop_mer","lib_sop_mer","lib_sop_mer","fea_edg_pre","fea_edg_pre","ann_fil","ann_fil","ann_fil","ann_fil","ann_fil","ann_fil","edg_spe","edg_spe","lib_mer_str_tax_cla","fea_pre"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":8,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Up to date","Stem"],"color":["#78B7C5","#354823","#899DA4"],"shape":["dot","dot","dot"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>We now recommend you to read the <a href="https://taxonomicallyinformedannotation.github.io/tima-r/articles/IV-processing.html">next
vignette</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adriano Rutz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
